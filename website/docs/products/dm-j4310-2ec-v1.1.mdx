import BlockImage from '@site/src/components/BlockImage';

# DM-J4310-2EC V1.1 減速モーター

[原文の使用説明書（中国語）](/pdf/products/dm-j4310-2ec-v1.1-zh.pdf)

本サイト全体のライセンスはApache License 2.0ですが、本資料および原文の資料にはライセンスを設定しません。

<BlockImage src="products/dm-j4310-2ec-v1.1/image1.jpeg" width="40%" />

| 日付 | バージョン | 変更内容 |
|--|--|--|
| 2023.11.16 | V1.0 | 初版作成 |

## 免責事項

達妙科技 &trade;DAMIAO &trade;DM-J4310-2EC V1.1 減速モーター（以下「本製品」といいます）をご購入いただき、誠にありがとうございます。
本製品をご使用になる前に、本文書および達妙科技が提供するすべての安全ガイドラインを注意深くお読みいただき、遵守してください。
そうしない場合、お客様や周囲の方々への危害、本製品やその他の周囲の物品の損傷を引き起こす可能性があります。
本製品を使用することにより、お客様は本文書を精読し、本文書および本製品に関連するすべての文書の条項と内容を理解、承認、承諾したものとみなされます。
お客様は本製品を正当な目的でのみ使用することを約束します。
お客様は本製品の使用およびそれにより生じる可能性のある結果について全責任を負うことを約束します。
達妙科技は、本製品の直接的または間接的な使用によって生じた損害、傷害、およびいかなる法的責任についても責任を負いません。

DAMIAOは深セン市達妙科技有限公司の商標です。
本文中に登場する製品名、ブランド名は、各社の商標です。
本製品及びマニュアルの著作権は深セン市達妙科技有限公司に帰属します。
許可なく複製・転載することは一切禁じられています。
本文書及び本製品に関連する全ての文書の最終的な解釈権は深セン市達妙科技有限公司に帰属します。
更新がある場合、別途通知はいたしません。

## 注意事項

1. モーターは規定の作業環境及び巻線許容最高温度範囲内で厳密に使用してください。これに従わない場合、製品に永久的で不可逆的な損傷が生じる可能性があります。
2. 異物が回転子内部に入るのを避けてください。さもないと回転子の異常動作を引き起こす可能性があります。
3. 使用前に各部品の健全性を確認してください。部品の欠落、劣化、損傷などが認められた場合は使用を中止してください。
4. 配線を正しく接続し、モーターが正しく確実に設置されていることを確認してください。
5. 使用中は電子ローター部分に触れないでください。事故を防止するためです。モーターが高トルク出力時には発熱が生じる場合がありますので、やけどに注意してください。
6. ユーザーによるモーターの分解は禁止です。分解すると制御精度が低下し、モーターの異常動作を引き起こす可能性があります。

## モーターの特徴

1. デュアルエンコーダ搭載により、出力軸の絶対位置を1回転単位で検出。電源断時でも絶対位置情報を保持します。
2. モーターとドライバーの一体型設計により、コンパクトで高集積化を実現します。
3. 上位機による可視化デバッグをサポートし、ファームウェアアップグレードに対応しています。
4. CANバス経由でモーター速度・位置・トルク・温度等の情報をフィードバックできます。
5. 二重温度保護機能を搭載しています。
6. 位置モードではトラペゾイド加減速をサポートしています。

## 納品リスト

1. モーター（ドライバー含む）×1
2. 電源（CAN通信端子付き）接続ケーブル：XT30(2+2)-Fプラグケーブル ×1
3. デバッグ用シリアル信号線：GH1.25接続線-3ピン× 1

## インターフェース及び配線順序説明

<table>
  <thead>
    <tr>
      <th>名称-番号</th>
      <th>インターフェース表記</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>電源インターフェース-1<br />（CAN通信端子を含む）</td>
      <td rowspan="2"><BlockImage src="products/dm-j4310-2ec-v1.1/image2.jpeg" /></td>
      <td rowspan="2">
        <ol>
          <li>XT30(2+2)-Fプラグの電源接続ケーブルで電源に接続し、定格電圧24Vでモーターに給電します。</li>
          <li>CAN通信端子を介して外部制御装置を接続することで、CAN制御コマンドを受信し、モーターの状態情報をフィードバックできます。</li>
          <li>
            モーターには2つの電源インターフェースが搭載されており、いずれのインターフェースも単独で使用できます。
            複数台を直列接続することもでき、配線作業を容易にします。
          </li>
        </ol>
      </td>
    </tr>
    <tr>
      <td>電源インターフェース-2<br />（CAN通信端子付き）</td>
    </tr>
    <tr>
      <td>デバッグ用シリアルポート-3</td>
      <td><BlockImage src="products/dm-j4310-2ec-v1.1/image3.jpeg" /></td>
      <td>
        GH1.25接続ケーブル-3ピンを介し、USB-CANデバッグツール（または汎用USB-シリアル変換モジュール）でPCに接続します。
        DAMIAOデバッグアシスタントによるモーターパラメータ設定やファームウェア更新が可能です。
      </td>
    </tr>
  </tbody>
</table>

## モーター寸法及び取付

モーター取付穴のサイズと位置を参照し、対応する装置にモーターを取り付けてください。

<BlockImage src="products/dm-j4310-2ec-v1.1/image4.jpeg" width="80%" />

<br />

<BlockImage src="products/dm-j4310-2ec-v1.1/image5.jpeg" width="80%" />

## インジケーターランプの状態

<table>
  <tbody>
    <tr>
      <td rowspan="2">正常状態</td>
      <td>緑色ランプ常時点灯</td>
      <td>イネーブルモード、正常動作状態</td>
    </tr>
    <tr>
      <td>赤ランプ常時点灯</td>
      <td>無効モード</td>
    </tr>
    <tr>
      <td>異常状態</td>
      <td>赤ランプ点滅</td>
      <td>
        <p>故障です。対応する故障タイプは以下の通りです：</p>
        <ul>
          <li>8------過圧；</li>
          <li>9------低電圧；</li>
          <li>A------過電流；</li>
          <li>B------MOS過熱；</li>
          <li>C------モーターコイル過熱；</li>
          <li>D------通信断；</li>
          <li>E------過負荷；</li>
        </ul>
        <p>フィードバックフレームまたはDAMIAOデバッグアシスタントインターフェースを通じて、発生した故障の種類を確認できます。</p>
      </td>
    </tr>
  </tbody>
</table>

## 動作モード

### MITモード

MITモードはオリジナルMITモードとの互換性を考慮して設計されており、シームレスな切り替えを実現すると同時に、制御範囲（P_MAX、V_MAX、T_MAX）を柔軟に設定可能です。
ESCは受信したCANデータを制御変数に変換して演算し、トルク値を電流ループの電流指令値として算出します。
電流ループはその制御法則に基づき、最終的に所定のトルク電流に到達します。その制御フロー図は以下の通りです：

<BlockImage src="products/dm-j4310-2ec-v1.1/image6.jpeg" width="80%" />

MITモデルから様々な制御モードを導出できます。
例えばKp=0、Kd≠0の場合、v_desを指定すれば等速回転を実現できます。
Kp=0、Kd=0の場合、t_ffを指定すれば所定のトルク出力を実現できます。

**注意：位置制御を行う場合、Kdに0を設定してはいけません。**
**そうするとモーターの振動を引き起こし、制御不能に陥る可能性があります。**

### 位置速度モード

位置カスケード制御は三環連鎖制御モードであり、位置ループが最外周ループとして機能し、その出力が速度ループの指令値となります。
速度ループの出力は内側電流ループの指令値として用いられ、実際の電流出力を制御します。制御ブロック図は下図の通りです：

<BlockImage src="products/dm-j4310-2ec-v1.1/image7.jpeg" width="80%" />

p_desは制御目標位置、v_desは動作過程における最大絶対速度値を制限するパラメータです。

位置カスケード制御モードは、デバッグアシスタントが推奨する制御パラメータを使用することで、良好な制御精度と比較的滑らかな制御プロセスを実現できますが、応答時間は比較的長くなります。設定可能な関連パラメータは v_des のほか、加減速度の設定があります。
制御プロセス中に余分な振動が発生した場合は、加減速度を上げることで改善できます。

**注意：p_des、v_desの単位はそれぞれrad 、rad/sであり、データ型はfloatです。**
**ダンピング係数は必ず0以外の正の数に設定してください。速度モードの注意事項を参照してください。**

### 速度モード

速度モードはモーターを設定速度で安定運転させることができ、その制御ブロック図は以下の通りです：

<BlockImage src="products/dm-j4310-2ec-v1.1/image8.jpeg" width="80%" />

**注意：v_desの単位はrad/s、データ型はfloatです。**
**デバッグアシスタントによる自動パラメータ計算を利用する場合、減衰係数を0以外の正の数（通常2.0～10.0の範囲）に設定する必要があります。**
**減衰係数が小さすぎると速度の振動や大きなオーバーシュートが発生し、大きすぎると立ち上がり時間が長くなります。推奨設定値は4.0です。**

## 使用

制御にはCAN標準フレームフォーマットを使用し、固定ボーレートは1Mbpsです。
機能別に受信フレームとフィードバックフレームに分類され、受信フレームは受信した制御データでモーターのコマンド制御を実現し、フィードバックフレームはモーターが上位コントローラに送信する状態データです。
モーターで選択されたモードに応じて、受信フレームのフォーマット定義とフレームIDはそれぞれ異なりますが、各種モードにおけるフィードバックフレームは共通です。

### フィードバックフレーム

フィードバックフレームIDはデバッグアシスタントで設定され（Master ID）、デフォルトは0です。
主にモーターの位置、速度、トルク情報をフィードバックし、そのフレームフォーマットは以下のように定義されます：

| フィードバックメッセージ | D[0] | D[1] | D[2] | D[3] | D[4] | D[5] | D[6] | D[7] |
|--|--|--|--|--|--|--|--|--|
| MST_ID | ID\|ERR&lt;&lt;4 | POS[15:8] | POS[7:0] | VEL[11:4] | VEL[3:0]\|T[11:8] | T[7:0] | T_MOS | T_Rotor |

以下のように定義されます：

ID はコントローラのIDを表し、CAN_IDの下位8ビットを取ります。

ERR は故障を示し、対応する故障タイプは以下の通りです：

* 8------過圧；
* 9------低電圧；
* A------過電流；
* B------MOS過熱；
* C------モーターコイル過熱；
* D------通信断；
* E------過負荷；

* POS：モーターの位置情報を示す
* VEL：モーターの速度情報を示す
* T：モーターのトルク情報を示す
* T_MOS はドライバ上の MOS の平均温度（単位：℃）
* T_Rotor はモーター内部コイルの平均温度（単位：℃）

位置、速度、トルクは線形マッピング関係を用いて浮動小数点データを符号付き固定小数点データに変換します。
位置は16ビットデータ、速度とトルクは12ビットを使用します。

### MITモードにおける制御フレーム

| 制御メッセージ | D[0] | D[1] | D[2] | D[3] | D[4] | D[5] | D[6] | D[7] |
|--|--|--|--|--|--|--|--|--|
| ID | p_des[15:8] | p_des[7:0] | v_des[11:4] | v_des[3:0]\|Kp[11:8] | Kp[7:0] | Kd[11:4] | Kd[3:0]\|t_ff[11:8]  | t_ff[7:0] |

フレームIDが設定されたCAN ID値と等しいです。

* p_des：位置指令値
* v_des：速度指令値
* Kp：位置比例係数
* Kd：位置微分係数
* t_ff：トルク指令値

各パラメータは前節のマッピング関係に準拠し、p_des、v_des、t_ffの範囲はデバッグアシスタントで設定可能です。

Kpの範囲は[0,500]、Kdの範囲は[0,5]です。

標準CANデータフレームは8バイトのみであり、MITの制御コマンドフォーマットではPosition、Velocity、Kp、Kd、Torqueの5つのパラメータを8バイトにビット単位で組み合わせます。
内訳：Positionが2バイト（16ビット）、Velocityが12ビット、Kpが12ビット、Kdが12ビットを占めます。


### 位置速度モードにおける制御フレーム

<table>
  <thead>
    <tr>
      <th>制御メッセージ</th>
      <th>D[0]</th>
      <th>D[1]</th>
      <th>D[2]</th>
      <th>D[3]</th>
      <th>D[4]</th>
      <th>D[5]</th>
      <th>D[6]</th>
      <th>D[7]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
     <td>0x100+ID</td>
     <td colspan="4">p_des</td>
     <td colspan="4">v_des</td>
    </tr>
  </tbody>
</table>

フレームIDは設定されたCAN ID値に0x100をオフセットした値です。

* p_des：位置指令、浮動小数点型。低位バイトが先頭、高位バイトが後ろに並ぶデータ配置（リトルエンディアン）
* v_des：速度指令、浮動小数点型。低位バイトが先頭、高位バイトが後ろに並ぶデータ配置（リトルエンディアン）

ここで送信するコマンドのCAN IDは *0x100+ID* です。
速度指令は台形加速度動作時の最高速度、すなわち等速区間の速度値です。

### 速度モード制御フレーム

<table>
  <thead>
    <tr>
      <th>制御メッセージ</th>
      <th>D[0]</th>
      <th>D[1]</th>
      <th>D[2]</th>
      <th>D[3]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x200+ID</td>
      <td colspan="4">v_des</td>
    </tr>
  </tbody>
</table>

フレームIDは設定されたCAN ID値に0x200のオフセットを加えた値です。

* v_des：速度指令、浮動小数点型。低位バイトが先頭、高位バイトが後ろに並ぶデータ配置（リトルエンディアン）

ここで送信するコマンドのCAN IDは *0x200+ID* です。

## DAMIAOデバッグアシスタントを使用

DAMIAO USB-CAN デバッグツールを使用し、PCとモーターを接続します。
DAMIAOアシスタントでモーターのパラメータ設定およびファームウェア更新ができます。

モーターデバッグ用シリアルポートはGH1.25接続ケーブル-3ピンでPCに接続します。
モーター電源インターフェースのCAN通信端子はXT30(2+2)-Fプラグ接続ケーブルでUSB-CANデバッグツールに接続します。
DAMIAOデバッグアシスタントでモーターのパラメータ設定やファームウェア更新などができます。

モーターのシリアルポート、CANポート、電源インターフェースを接続後、PC側でDAMIAOデバッグアシスタントを起動し、対応するシリアルデバイスを選択してシリアルポートを開きます。
この状態でモーターに電源を供給すると、シリアルポートに情報が表示され、Control Modeが現在の駆動モードを示します。

## モーターパラメータ

定速 120rpm、室温 25℃における測定性能曲線図：

<BlockImage src="products/dm-j4310-2ec-v1.1/image9.jpeg" width="80%" />

以下のパラメータに基づきモーターを適切にご使用ください。

<table>
  <tbody>
    <tr>
      <th rowspan="7">モーターパラメータ</th>
      <td>定格電圧</td>
      <td>24V</td>
    </tr>
    <tr>
      <td>定格電流</td>
      <td>2.5A</td>
    </tr>
    <tr>
      <td>ピーク電流</td>
      <td>7.5A</td>
    </tr>
    <tr>
      <td>定格トルク</td>
      <td>3NM</td>
    </tr>
    <tr>
      <td>ピークトルク</td>
      <td>7NM</td>
    </tr>
    <tr>
      <td>定格回転数</td>
      <td>120rpm</td>
    </tr>
    <tr>
      <td>無負荷時最高回転数</td>
      <td>200rpm</td>
    </tr>

    <tr>
      <th rowspan="4">モーター特性値</th>
      <td>減速比</td>
      <td>10:1</td>
    </tr>
    <tr>
      <td>極対数</td>
      <td>14</td>
    </tr>
    <tr>
      <td>相インダクタンス</td>
      <td>340μH</td>
    </tr>
    <tr>
      <td>相抵抗</td>
      <td>650mΩ</td>
    </tr>

    <tr>
      <th rowspan="3">構造と重量</th>
      <td>外径</td>
      <td>56mm</td>
    </tr>
    <tr>
      <td>高さ</td>
      <td>46mm</td>
    </tr>
    <tr>
      <td>モーター重量</td>
      <td>約300g</td>
    </tr>

    <tr>
      <th rowspan="3">エンコーダ</th>
      <td>エンコーダビット数</td>
      <td>14ビット</td>
    </tr>
    <tr>
      <td>エンコーダ個数</td>
      <td>2</td>
    </tr>
    <tr>
      <td>エンコーダタイプ</td>
      <td>磁気式（シングルターン）</td>
    </tr>

    <tr>
      <th rowspan="2">通信</th>
      <td>制御インターフェース</td>
      <td>CAN@1Mbps</td>
    </tr>
    <tr>
      <td>パラメータ設定インターフェース</td>
      <td>UART@921600bps</td>
    </tr>

    <tr>
      <th rowspan="9">制御と保護</th>
      <td rowspan="3">制御モード</td>
      <td>MITモード</td>
    </tr>
    <tr>
      <td>速度モード</td>
    </tr>
    <tr>
      <td>位置モード</td>
    </tr>
    <tr>
      <td rowspan="6">保護</td>
      <td>
        駆動過熱保護、保護温度：120℃、過熱モーターは動作を停止する「イネーブルモード」になります。
      </td>
    </tr>
    <tr>
      <td>
        モーター過熱保護、使用要件に基づき設定し、推奨上限温度は100℃を超えないことを推奨します。
        過熱時はモーターが「イネーブルモード」を解除します。
      </td>
    </tr>
    <tr>
      <td>
        モーター過電圧保護は、使用要件に基づき設定し、32Vを超えないことを推奨します。
        過電圧時は「イネーブルモード」を解除します。
      </td>
    </tr>
    <tr>
      <td>
        通信切断保護：設定周期内にCAN指令を受信しない場合、自動的に「イネーブルモード」を解除します。
      </td>
    </tr>
    <tr>
      <td>
        モーター過電流保護：使用要件に基づき設定し、9.8Aを超えないことを推奨します。
        過電流時は「イネーブルモード」を解除します。
      </td>
    </tr>
    <tr>
      <td>
        モーターの低電圧保護機能。電源電圧が設定値を下回った場合、「イネーブルモード」を解除します。
        電源電圧は15V以上を推奨します。
      </td>
    </tr>
  </tbody>
</table>
